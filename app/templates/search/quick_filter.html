{% extends "base.html" %}

{% block title %}
{% if filter_type == 'my_documents' %}Meus Documentos
{% elif filter_type == 'recent' %}Documentos Recentes
{% elif filter_type == 'favorites' %}Favoritos
{% elif filter_type == 'pending_approval' %}Pendente de Aprovação
{% endif %} - Sistema GED
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
            <div class="position-sticky pt-3">
                <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                    <span>Filtros Rápidos</span>
                </h6>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link {% if filter_type == 'my_documents' %}active{% endif %}" 
                           href="{{ url_for('search.quick_filter', filter_type='my_documents') }}">
                            <i class="bi bi-file-earmark"></i> Meus Documentos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if filter_type == 'recent' %}active{% endif %}" 
                           href="{{ url_for('search.quick_filter', filter_type='recent') }}">
                            <i class="bi bi-clock-history"></i> Recentes
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if filter_type == 'favorites' %}active{% endif %}" 
                           href="{{ url_for('search.quick_filter', filter_type='favorites') }}">
                            <i class="bi bi-star"></i> Favoritos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if filter_type == 'pending_approval' %}active{% endif %}" 
                           href="{{ url_for('search.quick_filter', filter_type='pending_approval') }}">
                            <i class="bi bi-hourglass-split"></i> Pendente de Aprovação
                        </a>
                    </li>
                </ul>
                
                <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                    <span>Busca</span>
                </h6>
                <ul class="nav flex-column mb-2">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('search.search') }}">
                            <i class="bi bi-search"></i> Busca Simples
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('search.advanced_search') }}">
                            <i class="bi bi-funnel"></i> Busca Avançada
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">
                    {% if filter_type == 'my_documents' %}<i class="bi bi-file-earmark"></i> Meus Documentos
                    {% elif filter_type == 'recent' %}<i class="bi bi-clock-history"></i> Documentos Recentes
                    {% elif filter_type == 'favorites' %}<i class="bi bi-star"></i> Favoritos
                    {% elif filter_type == 'pending_approval' %}<i class="bi bi-hourglass-split"></i> Pendente de Aprovação
                    {% endif %}
                </h1>
            </div>

            <!-- Error Message -->
            {% if error %}
            <div class="alert alert-danger" role="alert">
                <i class="bi bi-exclamation-triangle"></i> {{ error }}
            </div>
            {% endif %}

            <!-- Results Count -->
            {% if total_count is defined %}
            <div class="mb-3">
                <p class="text-muted">
                    <span class="badge bg-primary">{{ total_count }} documento(s) encontrado(s)</span>
                </p>
            </div>
            {% endif %}

            <!-- Results -->
            {% if results %}
            <div class="row mb-3">
                <div class="col-md-6">
                    <p class="text-muted">
                        Mostrando {{ ((page - 1) * per_page) + 1 }} - {{ min(page * per_page, total_count) }} de {{ total_count }}
                    </p>
                </div>
                <div class="col-md-6 text-end">
                    <div class="btn-group btn-group-sm" role="group">
                        <a href="{{ url_for('search.quick_filter', filter_type=filter_type, page=page, per_page=20) }}" 
                           class="btn btn-outline-secondary {% if per_page == 20 %}active{% endif %}">20</a>
                        <a href="{{ url_for('search.quick_filter', filter_type=filter_type, page=page, per_page=50) }}" 
                           class="btn btn-outline-secondary {% if per_page == 50 %}active{% endif %}">50</a>
                        <a href="{{ url_for('search.quick_filter', filter_type=filter_type, page=page, per_page=100) }}" 
                           class="btn btn-outline-secondary {% if per_page == 100 %}active{% endif %}">100</a>
                    </div>
                </div>
            </div>

            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Categoria</th>
                            <th>Tipo</th>
                            <th>Tamanho</th>
                            <th>Data Upload</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for doc in results %}
                        <tr>
                            <td>
                                <i class="bi bi-file-earmark-{{ 'pdf' if doc.tipo_mime == 'application/pdf' else 'text' }}"></i>
                                <a href="{{ url_for('documents.view_document', document_id=doc.id) }}">
                                    {{ doc.nome }}
                                </a>
                                {% if doc.descricao %}
                                <br><small class="text-muted">{{ doc.descricao[:100] }}{% if doc.descricao|length > 100 %}...{% endif %}</small>
                                {% endif %}
                                {% if doc.tags %}
                                <br>
                                {% for tag in doc.tags %}
                                <span class="badge bg-secondary">{{ tag.nome }}</span>
                                {% endfor %}
                                {% endif %}
                            </td>
                            <td>
                                {% if doc.categoria %}
                                {{ doc.categoria.nome }}
                                {% else %}
                                <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>
                                <span class="badge bg-info">{{ doc.extensao }}</span>
                            </td>
                            <td>{{ doc.tamanho_formatado }}</td>
                            <td>{{ doc.data_upload.strftime('%d/%m/%Y %H:%M') }}</td>
                            <td>
                                <div class="btn-group btn-group-sm" role="group">
                                    <a href="{{ url_for('documents.view_document', document_id=doc.id) }}" 
                                       class="btn btn-outline-primary" title="Visualizar">
                                        <i class="bi bi-eye"></i>
                                    </a>
                                    <a href="{{ url_for('documents.download_document', document_id=doc.id) }}" 
                                       class="btn btn-outline-success" title="Download">
                                        <i class="bi bi-download"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            {% if total_pages > 1 %}
            <nav aria-label="Navegação de resultados">
                <ul class="pagination justify-content-center">
                    <li class="page-item {% if page == 1 %}disabled{% endif %}">
                        <a class="page-link" href="{{ url_for('search.quick_filter', filter_type=filter_type, page=page-1, per_page=per_page) }}">
                            Anterior
                        </a>
                    </li>
                    
                    {% for p in range(1, total_pages + 1) %}
                        {% if p == 1 or p == total_pages or (p >= page - 2 and p <= page + 2) %}
                        <li class="page-item {% if p == page %}active{% endif %}">
                            <a class="page-link" href="{{ url_for('search.quick_filter', filter_type=filter_type, page=p, per_page=per_page) }}">
                                {{ p }}
                            </a>
                        </li>
                        {% elif p == page - 3 or p == page + 3 %}
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                        {% endif %}
                    {% endfor %}
                    
                    <li class="page-item {% if page == total_pages %}disabled{% endif %}">
                        <a class="page-link" href="{{ url_for('search.quick_filter', filter_type=filter_type, page=page+1, per_page=per_page) }}">
                            Próximo
                        </a>
                    </li>
                </ul>
            </nav>
            {% endif %}
            {% else %}
            <div class="alert alert-info" role="alert">
                <i class="bi bi-info-circle"></i> 
                {% if filter_type == 'my_documents' %}
                Você ainda não possui documentos.
                {% elif filter_type == 'recent' %}
                Nenhum documento recente encontrado (últimos 7 dias).
                {% elif filter_type == 'favorites' %}
                Você ainda não marcou nenhum documento como favorito.
                {% elif filter_type == 'pending_approval' %}
                Não há documentos pendentes de aprovação.
                {% endif %}
            </div>
            {% endif %}
        </main>
    </div>
</div>

<style>
.sidebar {
    position: fixed;
    top: 56px;
    bottom: 0;
    left: 0;
    z-index: 100;
    padding: 0;
    box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
    overflow-y: auto;
}

.sidebar .nav-link {
    font-weight: 500;
    color: #333;
    padding: 0.75rem 1rem;
}

.sidebar .nav-link:hover,
.sidebar .nav-link.active {
    background-color: #e9ecef;
}

.sidebar .nav-link i {
    margin-right: 0.5rem;
}
</style>
{% endblock %}
